<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Documentation — Veldra</title>
  <meta name="description" content="Technical reference for ReserveGrid OS: 34 GatewayReason codes, 15 VerdictReason codes, share event schema, 51 configuration keys, and security boundaries.">
  <meta name="theme-color" content="#080e1a">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="canonical" href="https://veldra.org/docs/">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/brand/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/brand/favicon-16.png">
  <link rel="apple-touch-icon" href="/assets/brand/apple-touch-icon.png">

  <meta property="og:title" content="Documentation — Veldra">
  <meta property="og:description" content="Technical reference for ReserveGrid OS: 34 GatewayReason codes, 15 VerdictReason codes, share event schema, 51 configuration keys, and security boundaries.">
  <meta property="og:url" content="https://veldra.org/docs/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">

  <link rel="stylesheet" href="/assets/style.css?v=14">
  <script src="/assets/script.js?v=14" defer></script>
</head>
<body>

  <nav class="topbar">
    <div class="container">
      <div class="nav">
        <a class="brand" href="/" aria-label="Veldra home">
          <img src="/assets/brand/veldra-logo.png" alt="Veldra">
        </a>
        <div class="navlinks">
          <a href="/">Home</a>
          <a href="/product/">Product</a>
          <a href="/docs/" aria-current="page">Docs</a>
          <a href="/about/">About</a>
        </div>
        <div class="nav-actions">
          <a href="/observe/" class="btn btn-primary btn-sm">Observe</a>
        </div>
        <button class="nav-toggle" aria-label="Menu" aria-expanded="false">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
        </button>
      </div>
    </div>
  </nav>

  <div class="container"><nav class="breadcrumb" aria-label="Breadcrumb"><a href="/">Home</a><span class="sep">/</span><span class="current">Docs</span></nav></div>

  <section class="hero-light">
    <div class="container">
      <div class="hero-inner fade-up">
        <div class="hero-label">
          <span class="hero-label-dot"></span>
          <span>Documentation</span>
        </div>
        <h1 class="hero-title">
          Technical Reference
        </h1>
        <p class="hero-sub">
          Reason codes, share event schema, configuration reference, protocol contract, and security boundaries.
        </p>
        <button class="btn btn-outline btn-sm" id="search-trigger" style="margin-top:16px;gap:8px;">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
          Search docs
          <span class="search-kbd" style="margin-left:4px;">&#8984;K</span>
        </button>
      </div>
    </div>
  </section>

  <!-- Search modal -->
  <div class="search-overlay" id="search-overlay">
    <div class="search-box">
      <div class="search-input-wrap">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <input class="search-input" id="search-input" type="text" placeholder="Search reason codes, config keys..." autocomplete="off">
        <span class="search-kbd">Esc</span>
      </div>
      <div class="search-results" id="search-results"></div>
    </div>
  </div>

  <!-- ── Gateway Reason Codes ───────────────── -->
  <section class="section" id="reason-codes">
    <div class="container">
      <div class="section-header">
        <h2>Gateway Reason Codes</h2>
        <p>34 machine-readable codes for every gateway decision. Filter by category below.</p>
      </div>

      <!-- Filter bar -->
      <div class="filter-bar fade-up">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="transport">Transport</button>
        <button class="filter-btn" data-filter="framing">Framing</button>
        <button class="filter-btn" data-filter="auth">Auth</button>
        <button class="filter-btn" data-filter="channel">Channel</button>
        <button class="filter-btn" data-filter="job">Job</button>
        <button class="filter-btn" data-filter="share">Share</button>
        <button class="filter-btn" data-filter="system">System</button>
      </div>

      <!-- Table -->
      <div class="table-wrap fade-up">
        <table class="data-table">
          <thead>
            <tr>
              <th>Code</th>
              <th>Category</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <!-- Transport (4) -->
            <tr data-category="transport">
              <td><code>noise_handshake_failed</code></td>
              <td><span class="tag tag-transport">Transport</span></td>
              <td>Noise NX handshake did not complete (crypto failure or incompatible params)</td>
            </tr>
            <tr data-category="transport">
              <td><code>noise_handshake_timeout</code></td>
              <td><span class="tag tag-transport">Transport</span></td>
              <td>Handshake exceeded handshake_timeout_ms</td>
            </tr>
            <tr data-category="transport">
              <td><code>unsupported_protocol_version</code></td>
              <td><span class="tag tag-transport">Transport</span></td>
              <td>Miner offered unsupported SV2 protocol version</td>
            </tr>
            <tr data-category="transport">
              <td><code>connection_rate_limited</code></td>
              <td><span class="tag tag-transport">Transport</span></td>
              <td>Inbound connections exceeded per-IP rate limit</td>
            </tr>

            <!-- Framing (7) -->
            <tr data-category="framing">
              <td><code>frame_decode_error</code></td>
              <td><span class="tag tag-framing">Framing</span></td>
              <td>SV2 binary frame could not be decoded</td>
            </tr>
            <tr data-category="framing">
              <td><code>frame_too_large</code></td>
              <td><span class="tag tag-framing">Framing</span></td>
              <td>Frame exceeded maximum allowed size</td>
            </tr>
            <tr data-category="framing">
              <td><code>peer_quota_exceeded</code></td>
              <td><span class="tag tag-framing">Framing</span></td>
              <td>Peer exceeded rate_limit_messages_per_sec or rate_limit_bytes_per_sec</td>
            </tr>
            <tr data-category="framing">
              <td><code>internal_framing_error</code></td>
              <td><span class="tag tag-framing">Framing</span></td>
              <td>Internal NDJSON message could not be parsed</td>
            </tr>
            <tr data-category="framing">
              <td><code>internal_line_too_large</code></td>
              <td><span class="tag tag-framing">Framing</span></td>
              <td>Internal message exceeded MAX_INTERNAL_LINE_BYTES (1 MiB)</td>
            </tr>
            <tr data-category="framing">
              <td><code>internal_version_mismatch</code></td>
              <td><span class="tag tag-framing">Framing</span></td>
              <td>Internal msg_type version not supported</td>
            </tr>
            <tr data-category="framing">
              <td><code>internal_unknown_msg_flood</code></td>
              <td><span class="tag tag-framing">Framing</span></td>
              <td>Unknown msg_type exceeded MAX_UNKNOWN_MSG_TYPE_PER_MINUTE (60)</td>
            </tr>

            <!-- Auth (3) -->
            <tr data-category="auth">
              <td><code>miner_unauthorized</code></td>
              <td><span class="tag tag-auth">Auth</span></td>
              <td>Worker identity not in allowlist and no prefix match</td>
            </tr>
            <tr data-category="auth">
              <td><code>identity_prefix_unmatched</code></td>
              <td><span class="tag tag-auth">Auth</span></td>
              <td>Worker identity did not match any prefix_map entry</td>
            </tr>
            <tr data-category="auth">
              <td><code>identity_too_long</code></td>
              <td><span class="tag tag-auth">Auth</span></td>
              <td>user_identity exceeded max_worker_id_bytes (128)</td>
            </tr>

            <!-- Channel (4) -->
            <tr data-category="channel">
              <td><code>channel_open_rejected</code></td>
              <td><span class="tag tag-channel">Channel</span></td>
              <td>OpenMiningChannel denied (mapped to SV2 error)</td>
            </tr>
            <tr data-category="channel">
              <td><code>channel_limit_exceeded</code></td>
              <td><span class="tag tag-channel">Channel</span></td>
              <td>Connection exceeded max_channels_per_connection</td>
            </tr>
            <tr data-category="channel">
              <td><code>invalid_channel_id</code></td>
              <td><span class="tag tag-channel">Channel</span></td>
              <td>Share referenced a channel_id not assigned to this connection</td>
            </tr>
            <tr data-category="channel">
              <td><code>extended_channel_unsupported</code></td>
              <td><span class="tag tag-channel">Channel</span></td>
              <td>Miner requested extended channel (V1.0.0 supports standard only)</td>
            </tr>

            <!-- Job (5) -->
            <tr data-category="job">
              <td><code>prevhash_switch_timeout</code></td>
              <td><span class="tag tag-job">Job</span></td>
              <td>Verdict did not arrive within prevhash_verdict_timeout_ms and stale hold expired</td>
            </tr>
            <tr data-category="job">
              <td><code>prevhash_verdict_rejected</code></td>
              <td><span class="tag tag-job">Job</span></td>
              <td>Verifier rejected the prevhash template (inline mode gates it)</td>
            </tr>
            <tr data-category="job">
              <td><code>template_cache_miss</code></td>
              <td><span class="tag tag-job">Job</span></td>
              <td>Template referenced by share not found in LRU cache</td>
            </tr>
            <tr data-category="job">
              <td><code>stale_job_submission</code></td>
              <td><span class="tag tag-job">Job</span></td>
              <td>Share referenced a job_id from a superseded template</td>
            </tr>
            <tr data-category="job">
              <td><code>upstream_unavailable</code></td>
              <td><span class="tag tag-job">Job</span></td>
              <td>Template source (template-manager) not reachable</td>
            </tr>

            <!-- Share (11) -->
            <tr data-category="share">
              <td><code>share_replay_detected</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>share_id already seen in dedup window</td>
            </tr>
            <tr data-category="share">
              <td><code>share_difficulty_below_target</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>Share hash did not meet channel difficulty</td>
            </tr>
            <tr data-category="share">
              <td><code>share_invalid_job_id</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>job_id not in active job table</td>
            </tr>
            <tr data-category="share">
              <td><code>share_invalid_nonce</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>Nonce validation failed</td>
            </tr>
            <tr data-category="share">
              <td><code>version_bit_violation</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>version_bits outside BIP320 general purpose mask</td>
            </tr>
            <tr data-category="share">
              <td><code>ntime_out_of_range</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>ntime outside allowed bounds</td>
            </tr>
            <tr data-category="share">
              <td><code>share_forward_failed</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>HTTP POST to share upstream failed (transport)</td>
            </tr>
            <tr data-category="share">
              <td><code>share_upstream_rejected</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>Upstream returned accepted=false</td>
            </tr>
            <tr data-category="share">
              <td><code>share_dropped_queue_full</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>Forward queue at capacity, share dropped per policy</td>
            </tr>
            <tr data-category="share">
              <td><code>share_evicted_from_queue</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>Share evicted from queue under drop_old policy</td>
            </tr>
            <tr data-category="share">
              <td><code>share_rate_limited</code></td>
              <td><span class="tag tag-share">Share</span></td>
              <td>Per-connection share rate exceeded limit</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ── Verdict Reason Codes ────────────────── -->
  <section class="section section-alt">
    <div class="container">
      <div class="section-header">
        <h2>Verdict Reason Codes</h2>
        <p>15 verdicts emitted by the template verifier. Used in template_verdict events and gateway disconnects.</p>
      </div>

      <div class="table-wrap fade-up">
        <table class="data-table">
          <thead>
            <tr>
              <th>Code</th>
              <th>Category</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>ok</code></td>
              <td><span class="tag tag-verdict">Verdict</span></td>
              <td>Template accepted by verifier</td>
            </tr>
            <tr>
              <td><code>avg_fee_below_minimum</code></td>
              <td><span class="tag tag-fees">Fees</span></td>
              <td>Average fee per vByte below configured minimum</td>
            </tr>
            <tr>
              <td><code>total_fees_below_minimum</code></td>
              <td><span class="tag tag-fees">Fees</span></td>
              <td>Total coinbase rewards below policy threshold</td>
            </tr>
            <tr>
              <td><code>coinbase_value_zero_rejected</code></td>
              <td><span class="tag tag-template">Template</span></td>
              <td>Coinbase output value is zero and policy rejects it</td>
            </tr>
            <tr>
              <td><code>tx_count_exceeded</code></td>
              <td><span class="tag tag-template">Template</span></td>
              <td>Transaction count exceeds policy maximum</td>
            </tr>
            <tr>
              <td><code>prev_hash_len_mismatch</code></td>
              <td><span class="tag tag-template">Template</span></td>
              <td>Previous block hash length does not match expected value</td>
            </tr>
            <tr>
              <td><code>invalid_prev_hash</code></td>
              <td><span class="tag tag-template">Template</span></td>
              <td>Previous block hash does not reference valid chain</td>
            </tr>
            <tr>
              <td><code>protocol_version_mismatch</code></td>
              <td><span class="tag tag-navy">Protocol</span></td>
              <td>Block version or protocol level not supported</td>
            </tr>
            <tr>
              <td><code>empty_template_rejected</code></td>
              <td><span class="tag tag-template">Template</span></td>
              <td>Template contains no transactions and policy rejects it</td>
            </tr>
            <tr>
              <td><code>policy_load_error</code></td>
              <td><span class="tag tag-system">System</span></td>
              <td>Verifier could not load or parse policy configuration</td>
            </tr>
            <tr>
              <td><code>mempool_backend_unavailable</code></td>
              <td><span class="tag tag-system">System</span></td>
              <td>Connection to mempool data source lost or unavailable</td>
            </tr>
            <tr>
              <td><code>internal_error</code></td>
              <td><span class="tag tag-system">System</span></td>
              <td>Internal verifier error or panic</td>
            </tr>
            <tr>
              <td><code>weight_ratio_exceeded</code></td>
              <td><span class="tag tag-safety">Safety</span></td>
              <td>Transaction weight exceeds allowed ratio to block size</td>
            </tr>
            <tr>
              <td><code>template_stale</code></td>
              <td><span class="tag tag-safety">Safety</span></td>
              <td>Template exceeds max_template_age_ms without update</td>
            </tr>
            <tr>
              <td><code>sigops_budget_warning</code></td>
              <td><span class="tag tag-safety">Safety</span></td>
              <td>Cumulative sigops budget near capacity</td>
            </tr>
            <tr>
              <td><code>coinbase_sigops_abnormal</code></td>
              <td><span class="tag tag-safety">Safety</span></td>
              <td>Coinbase script sigops count is abnormally high</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ── Share Event Reference ──────────────── -->
  <section class="section" id="share-events">
    <div class="container">
      <div class="section-header">
        <h2>Share Event Reference</h2>
        <p>Two-event lifecycle: share_accepted on receipt, share_forward_result on upstream response.</p>
      </div>

      <!-- share_accepted -->
      <div class="mb-6 fade-up">
        <h3 style="margin-bottom:16px;">share_accepted</h3>
        <p style="margin-bottom:20px;color:rgba(255,255,255,.6);">Emitted immediately when share is accepted by gateway. One event per valid share submission.</p>
        <div class="table-wrap">
          <table class="data-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>share_id</code></td>
                <td>SHA256 hash</td>
                <td>Proof-of-work deduplication key; stable identifier for this share</td>
              </tr>
              <tr>
                <td><code>event_id</code></td>
                <td>SHA256 hash</td>
                <td>Event attribution and integrity key; joins share_accepted to share_forward_result</td>
              </tr>
              <tr>
                <td><code>channel_id</code></td>
                <td>u32</td>
                <td>SV2 channel ID assigned to this miner connection</td>
              </tr>
              <tr>
                <td><code>job_id</code></td>
                <td>u32</td>
                <td>Job ID from active template cache</td>
              </tr>
              <tr>
                <td><code>worker_id</code></td>
                <td>String</td>
                <td>Authenticated worker identity from SV2 connection</td>
              </tr>
              <tr>
                <td><code>validation_level</code></td>
                <td>String</td>
                <td>Depth of validation performed: "basic", "full", or "enhanced"</td>
              </tr>
              <tr>
                <td><code>sv2_response</code></td>
                <td>"success" | "error"</td>
                <td>Whether share was accepted (success) or rejected (error)</td>
              </tr>
              <tr>
                <td><code>reason_code</code></td>
                <td>GatewayReason</td>
                <td>Machine-readable code for the decision; present if sv2_response = "error"</td>
              </tr>
              <tr>
                <td><code>fee_tier</code></td>
                <td>String</td>
                <td>Configured fee tier from policy (e.g., "low", "mid", "high")</td>
              </tr>
              <tr>
                <td><code>difficulty_target</code></td>
                <td>f64</td>
                <td>Channel difficulty at time of submission</td>
              </tr>
              <tr>
                <td><code>timestamp_ms</code></td>
                <td>u64</td>
                <td>Unix timestamp in milliseconds at gateway receipt</td>
              </tr>
              <tr>
                <td><code>gateway_instance_id</code></td>
                <td>String</td>
                <td>Identifier for the gateway process handling this share</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- share_forward_result -->
      <div class="mb-6 fade-up">
        <h3 style="margin-bottom:16px;">share_forward_result</h3>
        <p style="margin-bottom:20px;color:rgba(255,255,255,.6);">Emitted after upstream HTTP response is received (or timeout occurs). One event per share_accepted with sv2_response = "success".</p>
        <div class="table-wrap">
          <table class="data-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>share_id</code></td>
                <td>SHA256 hash</td>
                <td>Same share_id from corresponding share_accepted event</td>
              </tr>
              <tr>
                <td><code>event_id</code></td>
                <td>SHA256 hash</td>
                <td>Same event_id from corresponding share_accepted; join key</td>
              </tr>
              <tr>
                <td><code>forwarded</code></td>
                <td>bool</td>
                <td>Whether share was successfully transmitted to upstream (true = sent, false = queue dropped)</td>
              </tr>
              <tr>
                <td><code>upstream_accepted</code></td>
                <td>Option&lt;bool&gt;</td>
                <td>Upstream accept field from JSON response; null if connection failed</td>
              </tr>
              <tr>
                <td><code>upstream_http_status</code></td>
                <td>Option&lt;u16&gt;</td>
                <td>HTTP status code from upstream response; null if transport error</td>
              </tr>
              <tr>
                <td><code>upstream_error</code></td>
                <td>Option&lt;String&gt;</td>
                <td>Error message from upstream response; null if accepted or transport error</td>
              </tr>
              <tr>
                <td><code>reason_code</code></td>
                <td>Option&lt;GatewayReason&gt;</td>
                <td>Gateway reason if forwarded=false (queue drop, timeout, etc.); null if forwarded=true</td>
              </tr>
              <tr>
                <td><code>timestamp_ms</code></td>
                <td>u64</td>
                <td>Unix timestamp in milliseconds at result recording</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- 1:1 join invariant -->
      <div class="callout callout-green fade-up">
        <strong>1:1 join invariant:</strong> Every <code>share_accepted</code> with <code>sv2_response = "success"</code> produces exactly one <code>share_forward_result</code>. The adapter blocks on channel capacity rather than dropping results.
      </div>
    </div>
  </section>

  <!-- ── Configuration Reference ─────────────── -->
  <section class="section" id="config">
    <div class="container">
      <div class="section-header">
        <h2>Configuration Reference</h2>
        <p>51 TOML configuration keys across six categories. All values can be overridden by environment variables.</p>
      </div>

      <div class="tab-group fade-up">
        <!-- Core tab -->
        <div class="tab-buttons">
          <button class="tab-btn active" data-tab="core">Core</button>
          <button class="tab-btn" data-tab="noise">Noise</button>
          <button class="tab-btn" data-tab="timing">Timing</button>
          <button class="tab-btn" data-tab="share">Share</button>
          <button class="tab-btn" data-tab="auth">Auth</button>
          <button class="tab-btn" data-tab="escape">Escape Hatches</button>
        </div>

        <!-- Core content -->
        <div id="core" class="tab-content active">
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Default</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>mode</code></td>
                  <td>(required)</td>
                  <td>Deployment mode: "shadow", "observe", or "inline"</td>
                </tr>
                <tr>
                  <td><code>listen_addr</code></td>
                  <td>0.0.0.0:3333</td>
                  <td>Socket address for inbound miner connections</td>
                </tr>
                <tr>
                  <td><code>http_addr</code></td>
                  <td>127.0.0.1:8082</td>
                  <td>Socket address for HTTP API and metrics (/gateway/events, /metrics)</td>
                </tr>
                <tr>
                  <td><code>verifier_addr</code></td>
                  <td>127.0.0.1:5001</td>
                  <td>TCP address of pool-verifier for template verdicts</td>
                </tr>
                <tr>
                  <td><code>verifier_http_url</code></td>
                  <td>(derived)</td>
                  <td>HTTP endpoint for verifier GET /status; defaults to http://verifier_addr/status</td>
                </tr>
                <tr>
                  <td><code>upstream_url</code></td>
                  <td>(required)</td>
                  <td>URL of job server (template-manager or bitcoind RPC)</td>
                </tr>
                <tr>
                  <td><code>upstream_failure_policy</code></td>
                  <td>(required)</td>
                  <td>Action on upstream disconnect: "fail_closed" or "fail_open"</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Noise content -->
        <div id="noise" class="tab-content">
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Default</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>noise_key_file</code></td>
                  <td>(required)</td>
                  <td>Path to gateway's Noise static private key (32 bytes, hex encoded)</td>
                </tr>
                <tr>
                  <td><code>noise_cert_file</code></td>
                  <td>(required)</td>
                  <td>Path to gateway's certificate (for miner identity binding)</td>
                </tr>
                <tr>
                  <td><code>authority_public_key_file</code></td>
                  <td>(required)</td>
                  <td>Path to authorized public key for Noise handshake validation</td>
                </tr>
                <tr>
                  <td><code>http_api_key</code></td>
                  <td>(optional)</td>
                  <td>API key for HTTP endpoints; if set, all requests must include X-API-Key header</td>
                </tr>
                <tr>
                  <td><code>http_tls_cert_file</code></td>
                  <td>(optional)</td>
                  <td>Path to TLS certificate for HTTPS HTTP server</td>
                </tr>
                <tr>
                  <td><code>http_tls_key_file</code></td>
                  <td>(optional)</td>
                  <td>Path to TLS private key for HTTPS HTTP server</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Timing content -->
        <div id="timing" class="tab-content">
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Default</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>upstream_poll_interval_ms</code></td>
                  <td>3000</td>
                  <td>Milliseconds between upstream template polls</td>
                </tr>
                <tr>
                  <td><code>upstream_health_timeout_ms</code></td>
                  <td>5000</td>
                  <td>Timeout for upstream health check request</td>
                </tr>
                <tr>
                  <td><code>upstream_stale_max_ms</code></td>
                  <td>30000</td>
                  <td>Maximum age of template before marking upstream unavailable</td>
                </tr>
                <tr>
                  <td><code>prevhash_verdict_timeout_ms</code></td>
                  <td>50</td>
                  <td>Milliseconds to wait for verifier verdict on prevhash change</td>
                </tr>
                <tr>
                  <td><code>prevhash_stale_hold_ms</code></td>
                  <td>5000</td>
                  <td>Milliseconds to hold stale job before disconnect on prevhash timeout</td>
                </tr>
                <tr>
                  <td><code>health_probe_interval_ms</code></td>
                  <td>30000</td>
                  <td>Milliseconds between verifier health probes</td>
                </tr>
                <tr>
                  <td><code>verifier_heartbeat_interval_ms</code></td>
                  <td>15000</td>
                  <td>Milliseconds between heartbeat messages to verifier</td>
                </tr>
                <tr>
                  <td><code>max_template_age_ms</code></td>
                  <td>60000</td>
                  <td>Maximum age of cached template before VerdictReason: template_stale</td>
                </tr>
                <tr>
                  <td><code>template_cache_size</code></td>
                  <td>64</td>
                  <td>Maximum number of templates to retain in LRU cache</td>
                </tr>
                <tr>
                  <td><code>max_future_templates</code></td>
                  <td>2</td>
                  <td>Maximum number of unverified future templates allowed in-flight</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Share content -->
        <div id="share" class="tab-content">
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Default</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>share_upstream_url</code></td>
                  <td>(required)</td>
                  <td>HTTP endpoint for share submissions (pool backend POST target)</td>
                </tr>
                <tr>
                  <td><code>share_upstream_secret</code></td>
                  <td>(required)</td>
                  <td>HMAC-SHA256 secret for signing share POST requests</td>
                </tr>
                <tr>
                  <td><code>share_upstream_retries</code></td>
                  <td>2</td>
                  <td>Number of retries on transient upstream failures</td>
                </tr>
                <tr>
                  <td><code>share_forward_queue_size</code></td>
                  <td>50000</td>
                  <td>Maximum pending shares in forward queue</td>
                </tr>
                <tr>
                  <td><code>share_forward_max_in_flight</code></td>
                  <td>256</td>
                  <td>Maximum concurrent upstream requests</td>
                </tr>
                <tr>
                  <td><code>share_forward_queue_drop_policy</code></td>
                  <td>drop_new</td>
                  <td>Policy on queue overflow: "drop_new" or "drop_old"</td>
                </tr>
                <tr>
                  <td><code>share_dedup_window_size</code></td>
                  <td>10000</td>
                  <td>Deduplication window size (number of unique share_ids to track)</td>
                </tr>
                <tr>
                  <td><code>initial_difficulty</code></td>
                  <td>1.0</td>
                  <td>Initial share difficulty for new channels</td>
                </tr>
                <tr>
                  <td><code>share_upstream_submit_timeout_ms</code></td>
                  <td>2000</td>
                  <td>Timeout for individual upstream share submission</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Auth content -->
        <div id="auth" class="tab-content">
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Default</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>auth.mode</code></td>
                  <td>(required)</td>
                  <td>Authentication strategy: "allowlist", "prefix_map", or "open"</td>
                </tr>
                <tr>
                  <td><code>auth.allowlist</code></td>
                  <td>(optional)</td>
                  <td>Array of allowed worker identities (for allowlist mode)</td>
                </tr>
                <tr>
                  <td><code>auth.prefix_map</code></td>
                  <td>(optional)</td>
                  <td>Map of identity prefixes to policies (for prefix_map mode)</td>
                </tr>
                <tr>
                  <td><code>max_worker_id_bytes</code></td>
                  <td>128</td>
                  <td>Maximum allowed length of worker identity string</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Escape Hatches content -->
        <div id="escape" class="tab-content">
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Environment Variable</th>
                  <th>Purpose</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>VELDRA_ALLOW_DROP_OLD_INLINE</code></td>
                  <td>Allows drop_old share queue policy in inline mode (default: forbidden for safety)</td>
                </tr>
                <tr>
                  <td><code>VELDRA_GATEWAY_ALLOW_OPEN_AUTH</code></td>
                  <td>Permits auth.mode = "open" without allowlist/prefix_map (default: forbidden)</td>
                </tr>
                <tr>
                  <td><code>VELDRA_ALLOW_NO_API_KEY</code></td>
                  <td>Allows http_addr to be exposed without http_api_key authentication (default: forbidden)</td>
                </tr>
                <tr>
                  <td><code>VELDRA_ALLOW_PLAINTEXT</code></td>
                  <td>Permits miner connections without Noise encryption (default: forbidden)</td>
                </tr>
                <tr>
                  <td><code>VELDRA_ALLOW_INSECURE_HTTP_UPSTREAM</code></td>
                  <td>Allows upstream_url to use http:// instead of https:// (default: forbidden)</td>
                </tr>
                <tr>
                  <td><code>VELDRA_ALLOW_NO_SHARE_UPSTREAM_READY_INLINE</code></td>
                  <td>Permits inline mode when share upstream is not reachable at startup (default: forbidden)</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ── Security Boundaries ─────────────────── -->
  <section class="section section-alt" id="security">
    <div class="container">
      <div class="section-header">
        <h2>Security Boundaries</h2>
        <p>Design invariants and operational constraints.</p>
      </div>

      <div class="grid-3 fade-up">
        <div class="card">
          <h3>What it is</h3>
          <ul style="list-style-position:inside;color:rgba(255,255,255,.65);line-height:1.7;">
            <li>A miner-facing gateway that verifies templates in real-time</li>
            <li>Noise NX encrypted transport with certificate binding</li>
            <li>Deterministic fail-closed prevhash switching with 50ms timeout</li>
            <li>Machine-readable reason codes for every decision</li>
            <li>Two-event share lifecycle with HMAC-SHA256 signing</li>
          </ul>
        </div>

        <div class="card">
          <h3>What it is not</h3>
          <ul style="list-style-position:inside;color:rgba(255,255,255,.65);line-height:1.7;">
            <li>A pool backend or share accounting system</li>
            <li>A replacement for upstream policy enforcement</li>
            <li>A DDoS mitigation appliance (no rate limiting beyond peer quotas)</li>
            <li>A full peer-to-peer SV2 implementation</li>
            <li>A substitute for operator vigilance and monitoring</li>
          </ul>
        </div>

        <div class="card">
          <h3>Operational guidance</h3>
          <ul style="list-style-position:inside;color:rgba(255,255,255,.65);line-height:1.7;">
            <li>Always run in shadow mode first to establish trust</li>
            <li>Monitor verifier latency and uptime continuously</li>
            <li>Audit share_forward_result for upstream rejections</li>
            <li>Rotate http_api_key regularly and keep secure</li>
            <li>Use TLS for HTTP endpoints in production</li>
          </ul>
        </div>
      </div>

      <div class="callout callout-warn fade-up" style="margin-top:32px;">
        <strong>⚠ Critical:</strong> Do not expose <code>/gateway/events</code> or <code>/metrics</code> to untrusted networks.
        Set <code>http_api_key</code> in production. Both endpoints require authentication to prevent information leakage.
      </div>
    </div>
  </section>

  <!-- ── CTA ─────────────────────────────────── -->
  <section class="section">
    <div class="container">
      <div class="card card-glow fade-up cta-card">
        <h2 class="cta-title">Ready to integrate?</h2>
        <p class="cta-sub">
          Start with Observe mode to audit your templates. Move to Inline when you're confident in your policy.
        </p>
        <div class="cta-actions">
          <a href="/product/" class="btn btn-glow">Explore ReserveGrid OS</a>
          <a href="/observe/" class="btn btn-outline">Try Observe Mode</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ── Footer ──────────────────────────────── -->
  <footer class="footer">
    <div class="container">
      <div class="footer-inner">
        <div class="footer-brand">
          <img src="/assets/brand/veldra-logo.png" alt="Veldra">
          <p>SV2 mining gateway infrastructure for production pool operators.</p>
        </div>
        <div>
          <h4>Product</h4>
          <div class="footer-links">
            <a href="/product/">ReserveGrid OS</a>
            <a href="/product/#demo">Demo</a>
            <a href="/observe/">Observe Mode</a>
          </div>
        </div>
        <div>
          <h4>Resources</h4>
          <div class="footer-links">
            <a href="/docs/">Documentation</a>
            <a href="/docs/#reason-codes">Reason Codes</a>
            <a href="/docs/#config">Configuration</a>
          </div>
        </div>
        <div>
          <h4>Company</h4>
          <div class="footer-links">
            <a href="/about/">About</a>
            <a href="mailto:jarrondeng@veldra.org">Contact</a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <span>&copy; 2026 Veldra, Inc.</span>
        <div class="footer-legal">
          <a href="/privacy/">Privacy</a>
          <a href="/terms/">Terms</a>
          <a href="/disclaimer/">Disclaimer</a>
        </div>
      </div>
    </div>
  </footer>

  <button class="scroll-top" aria-label="Scroll to top">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M18 15l-6-6-6 6"/></svg>
  </button>
</body>
</html>
